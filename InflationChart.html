<!doctype html>
<html lang="en">
    <head>
        <title>Insights from an Inflation Model</title>
        <!-- JavaScript Charts Core Library -->
        <!-- script src="https://cdn.jsdelivr.net/npm/ag-charts-community/dist/umd/ag-charts-community.js"></script -->
        <script src="ag-charts-community.js"></script>
    </head>
    <body>
      <h2>Insights from an Inflation Model</h2>
      <form>
          Economy feedback settings<br>
          <input type=checkbox id=adgdpnp> Set Artifice to delta GDPNP<br>
          <input type=checkbox id=sndgdpnp> Set delta S to negative delta GDPNP<br>
          <input type=checkbox id=gdpnpcola> Set delta GDPNP to inflation rate<br>
          Starting point:<br>
          <input type=text value=7.3 id=gdpnp> GDPNP ($T)     <input type=text value=2.5 id=gdpnpGrowthRate> growth rate (% per year)   <input type=text value=0.5 id=gdpnpInflationCorrelation> inflation correlation coefficient    <br>
          <input type=text value=19.2 id=gdpp> GDPP ($T)      <input type=text value=2.5 id=gdppGrowthRate> growth rate (% per year)   <input type=text value=-0.2 id=gdppInflationCorrelation> inflation correlation coefficient    <br>
          <input type=text value=2 id=inflation> Inflation (% per year)<br>
          <input type=text value=5.8 id=savings> Savings ($T)<br>
          <input type=text value=53 id=inventory> Inventory ($T)<br>
          Inputs:<br>
          <input type=text id=deltagdpnp> delta GDPNP ($T)
              (<input type=checkbox id=deltaimpulsegdpnp> Impulse)
              (<input type=checkbox id=deltastepgdpnp> Step)
              (<input type=checkbox id=deltarampgdpnp> Ramp)
              (<input type=checkbox id=deltanoisegdpnp> White Noise)
          <br>
          <input type=text id=deltagdpp> delta GDPP ($T)
              (<input type=checkbox id=deltaimpulsegdpp> Impulse)
              (<input type=checkbox id=deltastepgdpp> Step)
              (<input type=checkbox id=deltarampgdpp> Ramp)
              (<input type=checkbox id=deltanoisegdpp> White Noise)
          <br>
          <input type=text value=0 id=artifice> Artifice ($T)
              (<input type=checkbox id=impulseartifice> Impulse)
              (<input type=checkbox id=stepartifice> Step)
              (<input type=checkbox id=rampartifice> Ramp)
              (<input type=checkbox id=noiseartifice> White Noise)
          <br>
          <input type=text id=deltasavings> delta savings ($T)
              (<input type=checkbox id=deltaimpulsesavings> Impulse)
              (<input type=checkbox id=deltastepsavings> Step)
              (<input type=checkbox id=deltarampsavings> Ramp)
              (<input type=checkbox id=deltanoisesavings> White Noise)
          <br>
          <input type=text id=deltainventory> delta inventory ($T)
              (<input type=checkbox id=deltaimpulseinventory> Impulse)
              (<input type=checkbox id=deltastepinventory> Step)
              (<input type=checkbox id=deltarampinventory> Ramp)
              (<input type=checkbox id=deltanoiseinventory> White Noise)
          <br>
          <br>
          <input type=button value="Run Simulation" id=runSim>
          <hr>
      </form>
      <script>
          var chartNames=[
             "Inflation","GDP/GDPP/GDPNP","Scaling","Artifice","Savings","Inventory"
          ];
          document.write("<table><tr>");
          for (var cnt=0; cnt<chartNames.length; cnt++) {
             var units=" $T";
             if (chartNames[cnt]=="Inflation") units=" %";
             if (chartNames[cnt]=="Scaling") units="";
             document.write("<td style='font-family:arial'><center>"+chartNames[cnt]+units+" vs time</center><div id='"+chartNames[cnt]+"Chart'></div></td>");
             if (((cnt%3)==2)&&(cnt+1<chartNames.length)) {
                 document.write("</tr><tr>");
             }
          }
          document.write("</tr></table>");
          // https://www.ag-grid.com/charts/javascript/quick-start/
          var chartObjects=[];
          function makeCharts(allData) {
             for (var cnt=0; cnt<chartNames.length; cnt++) {
                var lines=[];
                if (chartNames[cnt].indexOf("/")==-1) {
                    lines=[{ type: 'line', xKey: 'month', yKey: chartNames[cnt] }];
                } else {
                    var names=chartNames[cnt].split("/");
                    lines=new Array(names.length);
                    for (var cnt2=0; cnt2<names.length; cnt2++) {
                       lines[cnt2]={ type: 'line', xKey: 'month', yKey: names[cnt2] };
                    }
                }
                if (chartObjects[chartNames[cnt]]) chartObjects[chartNames[cnt]].destroy();
                chartObjects[chartNames[cnt]] = agCharts.AgCharts.create({
                   container: document.getElementById(chartNames[cnt]+'Chart'),
                   series: lines,
                   legend: {enabled:true},
                   data: allData[chartNames[cnt]],
                });
             }
          }

          function renameSet(setMap,newName) {
              var nameList=newName.split("/");
              for (var cnt=0; cnt<nameList.length; cnt++)
                  setMap[nameList[cnt]]=setMap["odata"]*(cnt+1)/nameList.length;
              setMap["interpolation"]={type:'smooth'};
              return setMap;
          }

          function getScalingValue(gdpp,gdpnp,artifice,deltaSavings,deltaInventory) {
              return (gdpnp+gdpp+artifice-deltaSavings)/(gdpp-deltaInventory);
          }

          function getGDPPGrowthRate() {
              return document.getElementById("gdppGrowthRate").value*0.01/12;
          }
          
          function getGDPNPGrowthRate() {
              return document.getElementById("gdpnpGrowthRate").value*0.01/12;
          }
          
          function getGDPPInflationCoefficient() {
              return document.getElementById("gdppInflationCorrelation").value*1;
          }
          
          function getGDPNPInflationCoefficient() {
              return document.getElementById("gdpnpInflationCorrelation").value*1;
          }
          
          function simulate(allData) {
             //"Inflation","GDP/GDPP/GDPNP","Scaling","Artifice","Savings","Inventory"
             var inflation=document.getElementById("inflation").value*0.01/12;
             var gdpnp=document.getElementById("gdpnp").value*1;
             var gdpp=document.getElementById("gdpp").value*1;
             var artifice=document.getElementById("artifice").value*1;
             var lastGdpnp=gdpnp;
             var lastGdpp=gdpp;
             var lastArtifice=artifice;
             var savings=document.getElementById("savings").value*1;
             var inventory=document.getElementById("inventory").value*1;
             var lastSavings=document.getElementById("savings").value*1;
             var lastInventory=document.getElementById("inventory").value*1;
             var lastLastInventory=document.getElementById("inventory").value*1;
             var lastLastSavings=document.getElementById("savings").value*1;
             allData["Inflation"]=[]; 
             allData["GDP/GDPP/GDPNP"]=[]; 
             allData["Scaling"]=[]; 
             allData["Artifice"]=[]; 
             allData["Savings"]=[]; 
             allData["Inventory"]=[]; 
             for (var tim=0; tim<60; tim++) {
                 var deltaSavings=savings-lastSavings;
                 var deltaInventory=inventory-lastInventory;
                 var delta2Savings=(savings-lastSavings)-(lastSavings-lastLastSavings);
                 var delta2Inventory=(inventory-lastInventory)-(lastInventory-lastLastInventory);
                 var deltaGdpnp=gdpnp-lastGdpnp;
                 var deltaGdpp=gdpp-lastGdpp;
                 var deltaArtifice=artifice-lastArtifice;
                 var scalingFactor=getScalingValue(gdpp,gdpnp,artifice,deltaSavings,deltaInventory);
                 allData["Inflation"].push({ month: tim+1, Inflation: inflation*100*12}); 
                 allData["GDP/GDPP/GDPNP"].push({ month: tim+1, GDP: gdpp+gdpnp, GDPP: gdpp, GDPNP: gdpnp }); 
                 allData["Scaling"].push({ month: tim+1, Scaling: scalingFactor }); 
                 allData["Artifice"].push({ month: tim+1, Artifice: artifice }); 
                 allData["Savings"].push({ month: tim+1, Savings: savings }); 
                 allData["Inventory"].push({ month: tim+1, Inventory: inventory }); 
                 gdpp+=gdpp*getGDPPGrowthRate()+gdpp*getGDPPInflationCoefficient()*inflation;
                 gdpnp+=gdpnp*getGDPNPGrowthRate()+gdpnp*getGDPNPInflationCoefficient()*inflation;
                 inflation+=(deltaGdpnp+deltaArtifice+scalingFactor*delta2Inventory-delta2Savings-(scalingFactor-1)*deltaGdpp)/(gdpp-deltaInventory);
                 lastLastInventory=lastInventory;
                 lastInventory=inventory;
                 lastLastSavings=lastSavings;
                 lastSavings=savings;
                 lastGdpnp=gdpnp;
                 lastGdpp=gdpp;
                 lastArtifice=artifice;
             }
          }

          var allData=[];
          simulate(allData);
          makeCharts(allData);
          document.getElementById("runSim").onclick=function() {
              var allData=[];
              simulate(allData);
              makeCharts(allData);
          };
        </script>
    </body>
</html>
